<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¯€ç´„èƒ½æºå¤§ä½œæˆ° - ç¶²é ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #0d1a2e;
            background-image: linear-gradient(160deg, #0d1a2e 0%, #0f2c57 100%);
        }
        .btn {
            @apply py-3 px-6 rounded-lg text-lg font-bold shadow-lg transition-transform duration-200 ease-in-out transform hover:-translate-y-1;
        }
        .btn-primary {
            @apply bg-green-500 text-white hover:bg-green-600 active:scale-95;
        }
        .btn-secondary {
            @apply bg-gray-600 text-white hover:bg-gray-700 active:scale-95;
        }
        .option-btn {
            @apply w-full text-center font-semibold p-4 my-2 border-2 border-gray-600 rounded-lg bg-gray-700/80 text-white hover:bg-gray-700 hover:border-sky-400 transition-all duration-200 transform hover:scale-102;
        }
        .option-btn.selected {
             @apply border-black bg-sky-800/80 ring-2 ring-sky-400;
        }
        /* æ–°å¢ï¼šåœ¨é¸å–é¸é …å‰é¡¯ç¤ºæ˜Ÿè™Ÿ */
        .option-btn.selected::before {
            content: "â­ ";
            margin-right: 0.25rem;
        }
        .option-btn.correct {
            @apply border-green-500 bg-green-900/60 ring-2 ring-green-500 text-green-200 font-bold;
        }
        .option-btn.incorrect {
            @apply border-red-500 bg-red-900/60 ring-2 ring-red-500 text-red-200 font-bold;
        }
        .hidden {
            display: none;
        }
        .coin-icon {
            display: inline-block;
            width: 28px;
            height: 28px;
            background-color: #facc15;
            border-radius: 50%;
            color: #ca8a04;
            text-align: center;
            font-weight: bold;
            line-height: 28px;
            margin-right: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-size: 16px;
        }
        .badge-icon {
            width: 90px;
            height: 90px;
        }
        .glass-panel {
            @apply bg-gray-800/50 backdrop-blur-md border border-gray-700/50;
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">

    <div id="app" class="w-full max-w-5xl mx-auto flex flex-col relative">

        <!-- Header -->
        <header id="game-header" class="hidden p-4 mb-6 glass-panel rounded-2xl">
            <div class="flex justify-between items-center">
                <div class="flex items-center">
                    <span class="coin-icon">E</span>
                    <span id="energy-coins" class="text-3xl font-bold">100</span>
                </div>
                <div class="flex items-center space-x-4">
                     <span class="text-lg">é—œå¡ <span id="question-number-header">1</span> / 6</span>
                    <button id="achievements-btn" class="text-yellow-400 hover:text-yellow-300 transition-colors">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 2a.75.75 0 01.75.75v.518a3.746 3.746 0 012.83 1.352l.382.381.52.026a.75.75 0 01.738.902l-.285 1.708a3.746 3.746 0 010 2.83l.285 1.708a.75.75 0 01-.738.902l-.52.026-.382.381a3.746 3.746 0 01-2.83 1.352v.518a.75.75 0 01-1.5 0v-.518a3.746 3.746 0 01-2.83-1.352l-.382-.381-.52-.026a.75.75 0 01-.738-.902l.285-1.708a3.746 3.746 0 010-2.83l-.285-1.708a.75.75 0 01.738-.902l.52.026.382-.381a3.746 3.746 0 012.83-1.352V2.75A.75.75 0 0110 2zM8.5 10a1.5 1.5 0 113 0 1.5 1.5 0 01-3 0z" clip-rule="evenodd" />
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <!-- Start Screen -->
        <div id="start-screen" class="relative flex flex-col justify-center items-center text-center rounded-2xl overflow-hidden shadow-2xl min-h-[550px]">
             <!-- Background Image -->
            <div class="absolute inset-0 bg-cover bg-center z-0" style="background-image: url('22b82182-6b1e-4643-a29e-f60b3816eadc.jpeg');"></div>
            <!-- Glass Panel Content -->
            <div class="relative z-10 flex flex-col justify-center items-center w-full h-full p-8 glass-panel">
                <h1 class="text-7xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-300 via-cyan-300 to-green-300 mb-4" style="text-shadow: 0 2px 6px rgba(0,0,0,0.5);">ç¯€ç´„èƒ½æºå¤§ä½œæˆ°</h1>
                <p class="text-gray-200 text-xl mb-10 max-w-2xl" style="text-shadow: 0 1px 4px rgba(0,0,0,0.7);">æŠ•å…¥100å…ƒå•Ÿå‹•è³‡é‡‘ï¼Œé–‹å§‹ä½ çš„ç¯€èƒ½æŒ‘æˆ°ï¼Œè´å–èƒ½æºå¹£ï¼Œç‚ºåœ°çƒå’Œç¤¾æœƒç›¡ä¸€ä»½åŠ›ï¼</p>
                <div class="w-full max-w-xs">
                    <button id="start-game-btn" class="btn btn-primary w-full text-2xl py-4">æ”¯ä»˜100å…ƒï¼Œé–‹å§‹éŠæˆ²</button>
                </div>
                <p class="text-xs text-gray-500 mt-4">é€™æ˜¯ä¸€å€‹æ¨¡æ“¬éç¨‹</p>
            </div>
        </div>
        
        <!-- Intro Animation Screen -->
        <div id="intro-screen" class="hidden flex-col justify-center items-center text-center p-8 h-96 glass-panel rounded-2xl">
             <h2 class="text-4xl font-bold text-blue-300 mb-6">èƒ½æºç¾ç‹€å°å‹•ç•«</h2>
             <div class="w-28 h-28 bg-blue-900/50 rounded-full flex items-center justify-center mb-6 ring-4 ring-blue-500/50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-blue-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
             </div>
             <p class="text-gray-300 text-lg">åœ°çƒçš„èƒ½æºæ­£åœ¨å¿«é€Ÿæ¶ˆè€—...<br>ä¸€å€‹å°å°çš„å‹•ä½œï¼Œå°±èƒ½å¸¶ä¾†å·¨å¤§çš„æ”¹è®Šã€‚</p>
        </div>

        <!-- Quiz Screen -->
        <main id="quiz-screen" class="hidden flex-grow p-8 glass-panel rounded-2xl">
             <div id="timer" class="w-full bg-gray-900 rounded-full h-3.5 mb-6 border border-gray-700">
                <div id="timer-bar" class="bg-yellow-400 h-full rounded-full" style="width: 100%"></div>
            </div>
            <div class="grid md:grid-cols-2 gap-8 items-center">
                <div class="md:pr-8">
                    <p class="text-lg font-bold text-green-400 mb-2">æŒ‘æˆ°é¡Œç›®</p>
                    <h2 id="question-text" class="text-4xl font-bold leading-tight">å•é¡Œæ–‡å­—</h2>
                </div>
                <div>
                    <div id="options-container" class="flex flex-col space-y-3">
                        <!-- Options will be generated here -->
                    </div>
                    <button id="submit-answer-btn" class="btn btn-primary w-full mt-6 opacity-50" disabled>ç¢ºå®šç­”æ¡ˆ</button>
                </div>
            </div>
        </main>
        
        <!-- Donation Screen -->
        <div id="donation-screen" class="hidden flex-grow p-8 flex flex-col items-center glass-panel rounded-2xl">
            <div class="text-center mb-8">
                <h2 class="text-5xl font-bold text-yellow-300">æŒ‘æˆ°çµæŸï¼</h2>
                <p class="text-gray-300 text-xl mt-2">æ­å–œä½ å®Œæˆæ‰€æœ‰é—œå¡ï¼</p>
                <p class="text-lg mt-6">ä½ æœ€å¾Œçš„èƒ½æºå¹£ï¼š</p>
                <div class="flex items-center justify-center mt-2">
                    <span class="coin-icon text-3xl w-12 h-12 leading-10">E</span>
                    <span id="final-coins" class="text-7xl font-bold">0</span>
                </div>
                 <p class="text-gray-400 mt-2 text-lg">å¯å…Œæ›æˆ <span id="cash-amount" class="font-bold text-green-400">0</span> å…ƒç¾é‡‘</p>
            </div>

            <div class="w-full max-w-3xl">
                <h3 class="font-bold text-center text-2xl mb-6">é¸æ“‡ä¸€å€‹å–®ä½ï¼Œå°‡æ„›å¿ƒæå‡ºå»</h3>
                <div id="donation-options" class="grid md:grid-cols-2 gap-4">
                    <!-- Donation options will be generated here as buttons -->
                </div>
            </div>
             <div class="mt-8">
                 <button id="restart-game-btn" class="btn btn-secondary text-xl">é‡æ–°æŒ‘æˆ°</button>
            </div>
        </div>

        <!-- Achievements & Modal Overlays -->
        <div id="overlay-container" class="absolute inset-0 bg-black/70 flex items-center justify-center z-20 hidden">
            <!-- Achievements Screen -->
            <div id="achievements-screen" class="hidden glass-panel p-8 max-w-lg w-full mx-4 relative rounded-2xl">
                <button id="close-achievements-btn" class="absolute top-4 right-4 text-gray-400 hover:text-gray-300">
                     <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <h2 class="text-3xl font-bold text-center mb-8 text-yellow-300">æˆ‘çš„æˆå°±</h2>
                <div id="badges-container" class="grid grid-cols-2 sm:grid-cols-4 gap-6 text-center">
                    <!-- Badges will be generated here -->
                </div>
            </div>
        
            <!-- Result/Tip Modal -->
            <div id="modal" class="hidden glass-panel p-8 max-w-md w-full mx-4 text-center rounded-2xl">
                <div id="modal-result-icon" class="w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center">
                    <!-- Icon here -->
                </div>
                <h2 id="modal-title" class="text-3xl font-bold mb-2"></h2>
                <p id="modal-text" class="text-xl text-gray-300 mb-6"></p>
                <div id="modal-tip-section" class="bg-yellow-900/50 border-l-4 border-yellow-400 text-yellow-200 p-4 rounded-lg mb-8 text-left">
                    <p class="font-bold">ç¯€èƒ½å°çŸ¥è­˜</p>
                    <p id="modal-tip-text"></p>
                </div>
                <button id="modal-next-btn" class="btn btn-primary w-full">ä¸‹ä¸€é—œ</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DOM Elements ---
        const screens = {
            start: document.getElementById('start-screen'),
            intro: document.getElementById('intro-screen'),
            quiz: document.getElementById('quiz-screen'),
            donation: document.getElementById('donation-screen'),
        };
        const overlayContainer = document.getElementById('overlay-container');
        const achievementsScreen = document.getElementById('achievements-screen');
        const modalEl = document.getElementById('modal');
        const gameHeader = document.getElementById('game-header');
        const energyCoinsEl = document.getElementById('energy-coins');
        const finalCoinsEl = document.getElementById('final-coins');
        const cashAmountEl = document.getElementById('cash-amount');
        const questionNumberHeaderEl = document.getElementById('question-number-header');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const submitAnswerBtn = document.getElementById('submit-answer-btn');
        const donationOptionsContainer = document.getElementById('donation-options');
        const badgesContainer = document.getElementById('badges-container');

        const modal = {
            icon: document.getElementById('modal-result-icon'),
            title: document.getElementById('modal-title'),
            text: document.getElementById('modal-text'),
            tipSection: document.getElementById('modal-tip-section'),
            tipText: document.getElementById('modal-tip-text'),
            nextBtn: document.getElementById('modal-next-btn'),
        };
        
        const timerBar = document.getElementById('timer-bar');

        // --- Game Data ---
        const questions = [
            { question: "ç‚ºäº†èˆ’é©åˆçœé›»ï¼Œå¤å¤©å†·æ°£æœ€å»ºè­°è¨­å®šåœ¨å¹¾åº¦ï¼Ÿ", options: ["20-22åº¦", "23-25åº¦", "26-28åº¦", "30åº¦ä»¥ä¸Š"], answer: 2, reward: 15, penalty: 5, tip: "å†·æ°£æº«åº¦æ¯èª¿é«˜1åº¦ï¼Œå°±èƒ½çœä¸‹ç´„6%çš„é›»åŠ›æ¶ˆè€—ã€‚" },
            { question: "ä»¥ä¸‹å“ªç¨®é›»å™¨åœ¨å¾…æ©Ÿæ™‚æœ€è€—é›»ï¼Œå»ºè­°å„ªå…ˆæ‹”æ‰æ’é ­ï¼Ÿ", options: ["æ‰‹æ©Ÿå……é›»å™¨", "æ•¸ä½æ©Ÿä¸Šç›’", "é›»é¢¨æ‰‡", "æª¯ç‡ˆ"], answer: 1, reward: 10, penalty: 5, tip: "æ•¸ä½æ©Ÿä¸Šç›’ã€éŸ³éŸ¿ç­‰æœ‰é™æ§åŠŸèƒ½çš„å®¶é›»ï¼Œå¾…æ©Ÿæ™‚è€—é›»é‡ç›¸ç•¶å¯è§€ã€‚" },
            { question: "ç‚ºäº†è®“å†°ç®±æ›´çœé›»ï¼Œé£Ÿç‰©æ‡‰è©²åœ¨ä»€éº¼ç‹€æ…‹ä¸‹æ”¾é€²å»ï¼Ÿ", options: ["ç†±é¨°é¨°æ™‚ç›´æ¥æ”¾å…¥", "æ”¾æ¶¼è‡³å®¤æº«å¾Œå†æ”¾å…¥", "å…ˆå†·å‡å†å†·è—", "ä»»ä½•æ™‚å€™éƒ½å¯ä»¥"], answer: 1, reward: 15, penalty: 5, tip: "ç†±é£Ÿç›´æ¥æ”¾å…¥å†°ç®±æœƒå¢åŠ å£“ç¸®æ©Ÿçš„è² æ“”ï¼Œä½¿å…¶é‹è½‰æ›´ä¹…ï¼Œæ¶ˆè€—æ›´å¤šé›»åŠ›ã€‚" },
            { question: "ä½¿ç”¨æ´—è¡£æ©Ÿæ™‚ï¼Œå“ªç¨®åšæ³•æ¯”è¼ƒç¬¦åˆç¯€èƒ½åŸå‰‡ï¼Ÿ", options: ["ç´¯ç©è¶³å¤ è¡£ç‰©é‡å†ä¸€æ¬¡æ´—", "æ¯å¤©æ´—å°‘é‡è¡£ç‰©", "ä½¿ç”¨å¤§é‡æ´—è¡£ç²¾", "é¸æ“‡æœ€å¼·åŠ›çš„æ´—è¡£æ¨¡å¼"], answer: 0, reward: 10, penalty: 5, tip: "æ´—è¡£æ©Ÿé‹è½‰ä¸€æ¬¡æ¶ˆè€—çš„æ°´é›»æ˜¯å›ºå®šçš„ï¼Œé›†ä¸­è¡£ç‰©ä¸€æ¬¡æ¸…æ´—å¯ä»¥æœ‰æ•ˆæ¸›å°‘æ´—è¡£æ¬¡æ•¸ï¼Œé”åˆ°çœæ°´çœé›»çš„æ•ˆæœã€‚" },
            { question: "åœ¨ARå ´æ™¯ä¸­ï¼Œä½ èµ°åˆ°æ’åº§å‰ã€‚ä½ æ‡‰è©²åšä»€éº¼ä¾†ç¯€èƒ½ï¼Ÿ", options: ["ç”¨ä¸€å€‹å»¶é•·ç·šæ’æ»¿æ‰€æœ‰é›»å™¨", "å°‡ä¸ç”¨çš„é›»å™¨æ’é ­æ‹”æ‰", "æŠŠæ’åº§æ“¦ä¹¾æ·¨", "ç¢ºèªé›»å£“æ˜¯å¦ç©©å®š"], answer: 1, reward: 20, penalty: 10, tip: "é¤Šæˆéš¨æ‰‹æ‹”æ’é ­çš„ç¿’æ…£ï¼Œæ˜¯ç¯€èƒ½æœ€ç›´æ¥æœ‰æ•ˆçš„æ–¹æ³•ä¹‹ä¸€ã€‚" },
            { question: "æ›´æ›å®¶ä¸­ç‡ˆå…·æ™‚ï¼Œå“ªç¨®é¸æ“‡æœ€ç¯€èƒ½ç’°ä¿ï¼Ÿ", options: ["å‚³çµ±ç™½ç†¾ç‡ˆæ³¡", "çœé›»ç‡ˆæ³¡(CFL)", "LEDç‡ˆæ³¡", "é¹µç´ ç‡ˆ"], answer: 2, reward: 15, penalty: 5, tip: "LEDç‡ˆæ³¡çš„ç™¼å…‰æ•ˆç‡æ˜¯å‚³çµ±ç‡ˆæ³¡çš„æ•¸å€ï¼Œä¸”å£½å‘½æ›´é•·ã€æ›´çœé›»ã€‚" }
        ];
        const charities = [
            { name: "å…’ç«¥ç¦åˆ©é™¢", icon: "ğŸ‘§" }, { name: "é•·è€…ç…§è­·ä¸­å¿ƒ", icon: "ğŸ‘µ" },
            { name: "åé„‰æ•™è‚²åŸºé‡‘", icon: "ğŸ“š" }, { name: "æµæµªå‹•ç‰©ä¹‹å®¶", icon: "ğŸ¶" }
        ];
        const achievements = [
            { id: 'rookie', name: 'ç¯€èƒ½æ–°ç§€', condition: (gs) => gs.correctAnswers >= 1, unlocked: false, icon: 'ğŸŒ±' },
            { id: 'expert', name: 'ç¯€èƒ½é”äºº', condition: (gs) => gs.correctAnswers >= 3, unlocked: false, icon: 'ğŸ’¡' },
            { id: 'master', name: 'ç’°ä¿å¤§å¸«', condition: (gs) => gs.correctAnswers >= questions.length, unlocked: false, icon: 'ğŸŒ' },
            { id: 'donor', name: 'æ…ˆå–„å®¶', condition: (gs) => gs.donated, unlocked: false, icon: 'ğŸ’–' },
        ];

        // --- Game State ---
        let gameState;
        let timerInterval;
        let selectedOption = null;

        function init() {
            gameState = { energyCoins: 100, currentQuestionIndex: 0, correctAnswers: 0, donated: false };
            achievements.forEach(a => a.unlocked = false);
            updateCoinsDisplay();
            showScreen('start');
        }

        function showScreen(screenName) {
            Object.values(screens).forEach(screen => screen.classList.add('hidden'));
            if(screens[screenName]) screens[screenName].classList.remove('hidden');
            gameHeader.classList.toggle('hidden', screenName === 'start' || screenName === 'intro');
        }

        function startGame() {
            showScreen('intro');
            setTimeout(() => {
                showScreen('quiz');
                loadQuestion();
            }, 2500);
        }
        
        function updateCoinsDisplay() {
            energyCoinsEl.textContent = gameState.energyCoins;
        }

        function loadQuestion() {
            if (gameState.currentQuestionIndex >= questions.length) {
                endGame();
                return;
            }
            
            selectedOption = null;
            resetOptionsStyle();
            submitAnswerBtn.disabled = true;
            submitAnswerBtn.classList.add('opacity-50');

            const q = questions[gameState.currentQuestionIndex];
            questionNumberHeaderEl.textContent = `${gameState.currentQuestionIndex + 1}`;
            questionTextEl.textContent = q.question;
            optionsContainer.innerHTML = '';
            
            q.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn text-lg';
                button.textContent = option;
                button.dataset.index = index;
                button.addEventListener('click', () => selectOption(button, index));
                optionsContainer.appendChild(button);
            });
            
            startTimer();
        }
        
        function selectOption(button, index) {
            selectedOption = index;
            resetOptionsStyle();
            button.classList.add('selected');
            submitAnswerBtn.disabled = false;
            submitAnswerBtn.classList.remove('opacity-50');
        }

        function resetOptionsStyle() {
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected', 'correct', 'incorrect');
            });
        }
        
        function startTimer() {
            clearInterval(timerInterval);
            timerBar.style.transition = 'none';
            timerBar.style.width = '100%';
            void timerBar.offsetWidth; 
            timerBar.style.transition = 'width 15s linear';
            timerBar.style.width = '0%';

            timerInterval = setTimeout(handleTimeout, 15000);
        }
        
        function handleTimeout() {
            clearInterval(timerInterval);
            timerBar.style.transition = 'none';
            checkAnswer(null);
        }

        function checkAnswer(selectedIndex) {
            clearInterval(timerInterval);
            timerBar.style.transition = 'none';

            const q = questions[gameState.currentQuestionIndex];
            const isCorrect = selectedIndex === q.answer;

            const options = optionsContainer.querySelectorAll('.option-btn');
            options.forEach(btn => btn.disabled = true);
            
            if (selectedIndex !== null) {
                options[selectedIndex].classList.add(isCorrect ? 'correct' : 'incorrect');
            }
            if (!isCorrect) {
                options[q.answer].classList.add('correct');
            }

            if (isCorrect) {
                gameState.energyCoins += q.reward;
                gameState.correctAnswers++;
                showModal(true, `+${q.reward} èƒ½æºå¹£`, q.tip);
            } else {
                gameState.energyCoins -= q.penalty;
                showModal(false, `-${q.penalty} èƒ½æºå¹£`, q.tip);
            }

            updateCoinsDisplay();
            checkAchievements();
        }

        function showModal(isCorrect, text, tip) {
            overlayContainer.classList.remove('hidden');
            achievementsScreen.classList.add('hidden');
            modalEl.classList.remove('hidden');
            
            modal.title.textContent = isCorrect ? 'ç­”å°äº†ï¼' : 'ç­”éŒ¯äº†ï¼';
            modal.text.textContent = text;
            modal.tipText.textContent = tip;
            
            modal.icon.innerHTML = isCorrect ? 
                `<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>` :
                `<svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>`;
            modal.icon.className = `w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center ${isCorrect ? 'bg-green-500' : 'bg-red-500'}`;
        }
        
        function nextQuestion() {
            overlayContainer.classList.add('hidden');
            modalEl.classList.add('hidden');
            gameState.currentQuestionIndex++;
            loadQuestion();
        }

        function endGame() {
            showScreen('donation');
            finalCoinsEl.textContent = gameState.energyCoins;
            const cash = Math.floor(gameState.energyCoins / 10);
            cashAmountEl.textContent = cash;
            
            donationOptionsContainer.innerHTML = '';
            charities.forEach(charity => {
                const button = document.createElement('button');
                button.className = 'btn bg-sky-600 hover:bg-sky-700 text-white w-full flex flex-col items-center justify-center p-4 text-center h-40';
                button.innerHTML = `
                    <div class="text-4xl mb-2">${charity.icon}</div>
                    <div class="font-bold text-xl">${charity.name}</div>
                    <div class="text-sky-200 mt-1 text-base">æå‡º ${cash} å…ƒ</div>
                `;
                button.addEventListener('click', () => donate(charity.name, cash));
                donationOptionsContainer.appendChild(button);
            });
        }
        
        function donate(charityName, amount) {
            gameState.donated = true;
            checkAchievements();
            
            overlayContainer.classList.remove('hidden');
            achievementsScreen.classList.add('hidden');
            modalEl.classList.remove('hidden');

            modal.title.textContent = "æ„Ÿè¬æ‚¨çš„æ„›å¿ƒï¼";
            modal.text.innerHTML = `æ‚¨å·²æˆåŠŸå°‡ <span class="font-bold text-green-400">${amount}</span> å…ƒæè´ˆçµ¦<br><span class="font-bold text-sky-400">${charityName}</span>`;
            modal.icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /></svg>`;
            modal.icon.className = 'w-20 h-20 mx-auto mb-4 rounded-full flex items-center justify-center bg-pink-500';
            modal.tipSection.classList.add('hidden');
            modal.nextBtn.textContent = "é—œé–‰";
            modal.nextBtn.onclick = () => {
                overlayContainer.classList.add('hidden');
                modalEl.classList.add('hidden');
                modal.tipSection.classList.remove('hidden');
                modal.nextBtn.textContent = "ä¸‹ä¸€é—œ";
                modal.nextBtn.onclick = nextQuestion;
            };
            
            donationOptionsContainer.querySelectorAll('button').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('opacity-50', 'cursor-not-allowed');
            });
        }
        
        function checkAchievements() {
            achievements.forEach(ach => {
                if (!ach.unlocked && ach.condition(gameState)) {
                    ach.unlocked = true;
                }
            });
        }

        function showAchievements() {
            badgesContainer.innerHTML = '';
            achievements.forEach(ach => {
                const badgeEl = document.createElement('div');
                badgeEl.className = 'flex flex-col items-center';
                const isUnlocked = ach.unlocked;
                
                badgeEl.innerHTML = `
                    <div class="badge-icon rounded-full flex items-center justify-center transition-all duration-300 ${isUnlocked ? 'bg-yellow-400' : 'bg-gray-700'}">
                        <span class="text-5xl transition-transform duration-300 ${isUnlocked ? 'scale-100' : 'scale-90'}">${ach.icon}</span>
                    </div>
                    <p class="font-bold mt-3 ${isUnlocked ? 'text-yellow-200' : 'text-gray-400'}">${ach.name}</p>
                `;
                if (!isUnlocked) {
                   badgeEl.classList.add('opacity-60');
                }
                badgesContainer.appendChild(badgeEl);
            });
            overlayContainer.classList.remove('hidden');
            modalEl.classList.add('hidden');
            achievementsScreen.classList.remove('hidden');
        }
        
        function closeOverlay() {
            overlayContainer.classList.add('hidden');
            achievementsScreen.classList.add('hidden');
            modalEl.classList.add('hidden');
        }

        // --- Event Listeners ---
        document.getElementById('start-game-btn').addEventListener('click', startGame);
        submitAnswerBtn.addEventListener('click', () => { if (selectedOption !== null) { checkAnswer(selectedOption); }});
        modal.nextBtn.addEventListener('click', nextQuestion);
        document.getElementById('restart-game-btn').addEventListener('click', init);
        document.getElementById('achievements-btn').addEventListener('click', showAchievements);
        document.getElementById('close-achievements-btn').addEventListener('click', closeOverlay);

        // --- Initial Load ---
        init();
    });
    </script>

</body>
</html>
